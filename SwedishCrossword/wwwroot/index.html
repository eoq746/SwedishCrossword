<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svenskt Korsord</title>
    <style>
        :root {
            --cell-size: 36px;
            --border-color: #333;
            --blocked-color: #1a1a1a;
            --cell-bg: #fff;
            --number-color: #666;
            --letter-color: #000;
            --highlight-color: #fffacd;
            --accent-color: #2563eb;
            --word-highlight: #e0f2fe;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
            overflow: hidden;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 6px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .puzzle-info {
            background: rgba(255,255,255,0.2);
            padding: 6px 14px;
            border-radius: 8px;
            margin-top: 8px;
            display: inline-block;
            font-size: 0.85rem;
        }

        .puzzle-info span {
            margin: 0 10px;
        }

        /* Main layout: Grid on left, Clues on right */
        .main-layout {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: flex-start; /* Align to top, not stretch */
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .grid-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            /* Grid section sizes to its content */
        }

        .grid-section h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1rem;
        }

        .crossword-grid {
            display: inline-block;
            border: 3px solid var(--border-color);
            background: var(--border-color);
            gap: 1px;
            /* Remove flex properties - let it size naturally */
        }

        .grid-row {
            display: flex;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: var(--cell-bg);
            border: 1px solid #ccc;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--letter-color);
            cursor: pointer;
            transition: background-color 0.15s;
        }

        .cell:hover:not(.blocked) {
            background: var(--highlight-color);
        }

        .cell.blocked {
            background: var(--blocked-color);
            cursor: default;
        }

        .cell.word-highlight {
            background: var(--word-highlight);
        }

        .cell .number {
            position: absolute;
            top: 1px;
            left: 2px;
            font-size: 0.55rem;
            font-weight: normal;
            color: var(--number-color);
        }

        .cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            outline: none;
            padding-top: 6px;
            caret-color: var(--accent-color);
        }

        .cell input:focus {
            background: var(--highlight-color);
        }

        .cell.correct input {
            color: #16a34a;
        }

        .cell.incorrect input {
            color: #dc2626;
            background: #fef2f2;
        }

        .cell.empty-warning {
            background: #fef3c7;
        }

        .controls {
            display: flex;
            gap: 6px;
            margin-top: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: #16a34a;
            color: white;
        }

        .btn-success:hover {
            background: #15803d;
        }

        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 10px;
        }

        /* Clues section - matches grid height with scrollable content */
        .clues-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            min-width: 450px;
            max-width: 550px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Use JavaScript to set max-height based on grid section */
            max-height: var(--clues-max-height, 600px);
        }

        .clues-section h2 {
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 10px;
            padding-bottom: 6px;
            border-bottom: 2px solid var(--accent-color);
            flex-shrink: 0;
        }

        .clues-columns {
            display: flex;
            gap: 15px;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .clue-column {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .clue-direction {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .clue-direction h3 {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid #e5e7eb;
            flex-shrink: 0;
        }

        .clue-list {
            list-style: none;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            padding-right: 5px;
        }

        .clue-list::-webkit-scrollbar {
            width: 6px;
        }

        .clue-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .clue-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .clue-list::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        .clue-item {
            padding: 6px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.15s;
            font-size: 0.85rem;
            line-height: 1.3;
        }

        .clue-item:hover {
            background: #f3f4f6;
        }

        .clue-item.active {
            background: var(--word-highlight);
            border-left: 3px solid var(--accent-color);
        }

        .clue-number {
            font-weight: bold;
            color: var(--accent-color);
            margin-right: 6px;
        }

        .stats {
            text-align: center;
            margin-top: 8px;
            color: #666;
            font-size: 0.8rem;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2rem;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive: stack on smaller screens */
        @media (max-width: 1100px) {
            .main-layout {
                flex-direction: column;
                align-items: center;
            }
            
            .clues-section {
                min-width: auto;
                max-width: 100%;
                width: 100%;
            }
        }

        @media (max-width: 600px) {
            :root {
                --cell-size: 28px;
            }
            
            header h1 {
                font-size: 1.6rem;
            }
            
            .clues-columns {
                flex-direction: column;
                gap: 15px;
            }
            
            .clue-column {
                min-width: auto;
            }

            .clues-section {
                min-width: auto;
            }
        }

        @media print {
            body {
                background: white;
                padding: 10px;
            }
            
            .controls, .timer, .puzzle-info {
                display: none;
            }
            
            .grid-section, .clues-section {
                box-shadow: none;
                break-inside: avoid;
            }

            .cell input {
                border: none;
            }

            .clue-list {
                max-height: none;
                overflow: visible;
            }

            .main-layout {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>???? Svenskt Korsord</h1>
            <p>Klicka på en ruta och skriv bokstäver • Mellanslag byter riktning • Piltangenter navigerar</p>
            <div class="puzzle-info" id="puzzle-info" style="display: none;">
                <span id="info-size"></span>
                <span id="info-words"></span>
                <span id="info-fill"></span>
            </div>
        </header>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Laddar korsord...</p>
        </div>

        <div class="main-layout" id="main-layout" style="display: none;">
            <div class="grid-section">
                <h2>Korsord</h2>
                <div class="timer" id="timer">00:00</div>
                <div class="crossword-grid" id="crossword-grid"></div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="checkAnswers()">? Kontrollera</button>
                    <button class="btn btn-secondary" onclick="clearGrid()">??? Rensa</button>
                    <button class="btn btn-success" onclick="showSolution()">??? Visa lösning</button>
                    <button class="btn btn-secondary" onclick="printPuzzle()">??? Skriv ut</button>
                </div>
                <div class="stats" id="stats"></div>
            </div>

            <div class="clues-section">
                <h2>Ledtrådar</h2>
                <div class="clues-columns">
                    <div class="clue-column">
                        <div class="clue-direction">
                            <h3>Vågrätt ?</h3>
                            <ul class="clue-list" id="across-clues"></ul>
                        </div>
                    </div>
                    <div class="clue-column">
                        <div class="clue-direction">
                            <h3>Lodrätt ?</h3>
                            <ul class="clue-list" id="down-clues"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let puzzleData = {
            width: 11,
            height: 11,
            wordCount: 2,
            fillPercentage: 10.0,
            cells: [
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [{num: 1, letter: 'K'}, {letter: 'A'}, {num: 2, letter: 'L'}, {letter: 'S'}, {letter: 'O'}, {letter: 'N'}, {letter: 'G'}, {letter: 'E'}, {letter: 'R'}, null, null],
                [null, null, {letter: 'Ö'}, null, null, null, null, null, null, null, null],
                [null, null, {letter: 'V'}, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
                [null, null, null, null, null, null, null, null, null, null, null],
            ],
            clues: {
                across: [{ number: 1, clue: "Underkläder för män", answer: "KALSONGER" }],
                down: [{ number: 2, clue: "Träd med gröna blad", answer: "LÖV" }]
            }
        };

        let timerInterval, seconds = 0, puzzleSolved = false, currentDirection = 'across';

        async function loadPuzzle() {
            try {
                const response = await fetch('puzzle.json');
                if (response.ok) {
                    puzzleData = await response.json();
                }
            } catch (e) { console.log('Using default puzzle'); }
            init();
        }

        function init() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-layout').style.display = 'flex';
            
            if (puzzleData.wordCount) {
                document.getElementById('puzzle-info').style.display = 'inline-block';
                document.getElementById('info-size').textContent = `?? ${puzzleData.width}×${puzzleData.height}`;
                document.getElementById('info-words').textContent = `?? ${puzzleData.wordCount} ord`;
                document.getElementById('info-fill').textContent = `?? ${puzzleData.fillPercentage}%`;
            }
            
            renderGrid();
            renderClues();
            syncCluesHeight(); // Sync heights after rendering
            startTimer();
            updateStats();
            
            // Re-sync on window resize
            window.addEventListener('resize', syncCluesHeight);
        }

        function syncCluesHeight() {
            // Match clues section height to grid section height
            const gridSection = document.querySelector('.grid-section');
            const cluesSection = document.querySelector('.clues-section');
            if (gridSection && cluesSection) {
                const gridHeight = gridSection.offsetHeight;
                cluesSection.style.maxHeight = gridHeight + 'px';
            }
        }

        function renderGrid() {
            const grid = document.getElementById('crossword-grid');
            grid.innerHTML = '';
            for (let row = 0; row < puzzleData.height; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'grid-row';
                for (let col = 0; col < puzzleData.width; col++) {
                    const cellData = puzzleData.cells[row]?.[col];
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'cell';
                    cellDiv.dataset.row = row;
                    cellDiv.dataset.col = col;
                    if (cellData === null) {
                        cellDiv.classList.add('blocked');
                    } else {
                        if (cellData.num) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'number';
                            numSpan.textContent = cellData.num;
                            cellDiv.appendChild(numSpan);
                        }
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.dataset.answer = cellData.letter;
                        input.addEventListener('input', handleInput);
                        input.addEventListener('keydown', handleKeyDown);
                        input.addEventListener('focus', () => handleFocus(row, col));
                        cellDiv.appendChild(input);
                    }
                    rowDiv.appendChild(cellDiv);
                }
                grid.appendChild(rowDiv);
            }
        }

        function renderClues() {
            const acrossContainer = document.getElementById('across-clues');
            const downContainer = document.getElementById('down-clues');
            acrossContainer.innerHTML = '';
            downContainer.innerHTML = '';

            (puzzleData.clues.across || []).forEach(clue => {
                const li = document.createElement('li');
                li.className = 'clue-item';
                li.innerHTML = `<span class="clue-number">${clue.number}.</span>${clue.clue}`;
                li.dataset.number = clue.number;
                li.dataset.direction = 'across';
                li.addEventListener('click', () => focusClue(clue.number, 'across'));
                acrossContainer.appendChild(li);
            });

            (puzzleData.clues.down || []).forEach(clue => {
                const li = document.createElement('li');
                li.className = 'clue-item';
                li.innerHTML = `<span class="clue-number">${clue.number}.</span>${clue.clue}`;
                li.dataset.number = clue.number;
                li.dataset.direction = 'down';
                li.addEventListener('click', () => focusClue(clue.number, 'down'));
                downContainer.appendChild(li);
            });
        }

        function handleInput(e) {
            e.target.value = e.target.value.toUpperCase();
            e.target.parentElement.classList.remove('empty-warning');
            if (e.target.value) moveInDirection(e.target);
            updateStats();
        }

        function handleKeyDown(e) {
            const cell = e.target.parentElement;
            const row = parseInt(cell.dataset.row), col = parseInt(cell.dataset.col);
            switch (e.key) {
                case 'ArrowRight': currentDirection = 'across'; moveTo(row, col + 1); e.preventDefault(); break;
                case 'ArrowLeft': currentDirection = 'across'; moveTo(row, col - 1); e.preventDefault(); break;
                case 'ArrowDown': currentDirection = 'down'; moveTo(row + 1, col); e.preventDefault(); break;
                case 'ArrowUp': currentDirection = 'down'; moveTo(row - 1, col); e.preventDefault(); break;
                case 'Backspace': if (!e.target.value) { moveBackInDirection(e.target); e.preventDefault(); } break;
                case ' ': currentDirection = currentDirection === 'across' ? 'down' : 'across'; handleFocus(row, col); e.preventDefault(); break;
            }
        }

        function handleFocus(row, col) { highlightWord(row, col); highlightClue(row, col); }

        function highlightWord(row, col) {
            document.querySelectorAll('.cell.word-highlight').forEach(c => c.classList.remove('word-highlight'));
            if (currentDirection === 'across') {
                let startCol = col;
                while (startCol > 0 && puzzleData.cells[row]?.[startCol - 1] !== null) startCol--;
                for (let c = startCol; c < puzzleData.width && puzzleData.cells[row]?.[c] !== null; c++) {
                    document.querySelector(`.cell[data-row="${row}"][data-col="${c}"]`)?.classList.add('word-highlight');
                }
            } else {
                let startRow = row;
                while (startRow > 0 && puzzleData.cells[startRow - 1]?.[col] !== null) startRow--;
                for (let r = startRow; r < puzzleData.height && puzzleData.cells[r]?.[col] !== null; r++) {
                    document.querySelector(`.cell[data-row="${r}"][data-col="${col}"]`)?.classList.add('word-highlight');
                }
            }
        }

        function moveTo(row, col) {
            if (row < 0 || row >= puzzleData.height || col < 0 || col >= puzzleData.width) return false;
            if (puzzleData.cells[row]?.[col] === null) return false;
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            if (cell && !cell.classList.contains('blocked')) {
                cell.querySelector('input')?.focus();
                return true;
            }
            return false;
        }

        function moveInDirection(input) {
            const cell = input.parentElement;
            const row = parseInt(cell.dataset.row), col = parseInt(cell.dataset.col);
            currentDirection === 'across' ? moveTo(row, col + 1) : moveTo(row + 1, col);
        }

        function moveBackInDirection(input) {
            const cell = input.parentElement;
            const row = parseInt(cell.dataset.row), col = parseInt(cell.dataset.col);
            currentDirection === 'across' ? moveTo(row, col - 1) : moveTo(row - 1, col);
        }

        function focusClue(number, direction) {
            currentDirection = direction;
            for (let row = 0; row < puzzleData.height; row++) {
                for (let col = 0; col < puzzleData.width; col++) {
                    if (puzzleData.cells[row]?.[col]?.num === number) { moveTo(row, col); return; }
                }
            }
        }

        function highlightClue(row, col) {
            document.querySelectorAll('.clue-item').forEach(item => item.classList.remove('active'));
            const cellData = puzzleData.cells[row]?.[col];
            if (cellData?.num) {
                const clueItem = document.querySelector(`.clue-item[data-number="${cellData.num}"][data-direction="${currentDirection}"]`);
                if (clueItem) { clueItem.classList.add('active'); clueItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }
            }
        }

        function checkAnswers() {
            const inputs = document.querySelectorAll('.cell:not(.blocked) input');
            let correct = 0, total = inputs.length, filled = 0;
            inputs.forEach(input => {
                const cell = input.parentElement;
                cell.classList.remove('correct', 'incorrect', 'empty-warning');
                const value = input.value.toUpperCase();
                if (value) {
                    filled++;
                    if (value === input.dataset.answer) { correct++; cell.classList.add('correct'); }
                    else { cell.classList.add('incorrect'); }
                } else { cell.classList.add('empty-warning'); }
            });
            if (filled === total && correct === total) {
                puzzleSolved = true; stopTimer();
                inputs.forEach(i => i.parentElement.classList.remove('empty-warning'));
                setTimeout(() => alert(`?? Grattis! Du löste korsordet på ${formatTime(seconds)}!`), 100);
            } else if (filled < total) {
                alert(`Du har ${total - filled} tomma rutor kvar.\n\n${correct} av ${filled} ifyllda är korrekta.`);
            } else {
                alert(`${filled - correct} bokstäver är felaktiga. Försök igen!`);
            }
        }

        function clearGrid() {
            if (confirm('Vill du rensa alla svar?')) {
                document.querySelectorAll('.cell:not(.blocked) input').forEach(input => {
                    input.value = '';
                    input.parentElement.classList.remove('correct', 'incorrect', 'empty-warning');
                });
                updateStats();
            }
        }

        function showSolution() {
            if (confirm('Vill du visa lösningen?')) {
                document.querySelectorAll('.cell:not(.blocked) input').forEach(input => {
                    input.value = input.dataset.answer;
                    input.parentElement.classList.remove('empty-warning', 'incorrect');
                    input.parentElement.classList.add('correct');
                });
                puzzleSolved = true; stopTimer(); updateStats();
            }
        }

        function printPuzzle() {
            const inputs = document.querySelectorAll('.cell:not(.blocked) input');
            const values = Array.from(inputs).map(i => i.value);
            inputs.forEach(i => i.value = '');
            window.print();
            inputs.forEach((i, idx) => i.value = values[idx]);
        }

        function startTimer() { timerInterval = setInterval(() => { if (!puzzleSolved) { seconds++; document.getElementById('timer').textContent = formatTime(seconds); } }, 1000); }
        function stopTimer() { clearInterval(timerInterval); }
        function formatTime(s) { return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
        function updateStats() {
            const inputs = document.querySelectorAll('.cell:not(.blocked) input');
            const filled = Array.from(inputs).filter(i => i.value).length;
            document.getElementById('stats').textContent = `${filled}/${inputs.length} rutor ifyllda (${Math.round(filled/inputs.length*100)}%)`;
        }

        document.addEventListener('DOMContentLoaded', loadPuzzle);
    </script>
</body>
</html>
